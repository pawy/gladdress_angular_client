$(function(){FastClick.attach(document.body)}),angular.module("starterapp",["templates","ui.router","ngAnimate","ngMessages","uuid","ngCookies","ngSanitize"]).config(["$stateProvider","$locationProvider","$urlRouterProvider",function(t,e,a){e.html5Mode(!0),t.state("contacts",{url:"/",title:"Contacts",views:{"":{templateUrl:"/templates/contacts/contacts.html"},"list@contacts":{controller:"ContactsListController",templateUrl:"/templates/contacts/contacts.list.html"},"content@contacts":{templateUrl:"/templates/contacts/contacts.content.html"}}}).state("contacts.new",{url:"contact/new",title:"New Contact",views:{"content@contacts":{controller:"ContactsNewController",templateUrl:"/templates/contacts/new/contacts.new.html"}}}).state("contacts.detail",{url:"contact/{id}",title:"Contact Detail",resolve:{contact:["$stateParams","ContactsService",function(t,e){return e.getById(t.id).then(function(t){return t})}]},views:{"content@contacts":{controller:"ContactsDetailsController",templateUrl:"/templates/contacts/detail/contacts.detail.html"}}}).state("contacts.detail.edit",{url:"/edit",views:{"content@contacts":{controller:"ContactsDetailsController",templateUrl:"/templates/contacts/detail/contacts.edit.html"}}}).state("about",{url:"/#about",controller:"AboutController",templateUrl:"/templates/about/about.html",title:"About"}).state("login",{url:"/#login",controller:"LoginController",templateUrl:"/templates/login/login.html",title:"Login"}),a.otherwise("/")}]).run(["$rootScope","$state","$stateParams","$cookieStore","$http",function(t,e,a,n,o){t.$on("$stateChangeSuccess",function(e,a){t.pageTitle=a.title||""}),t.globals=n.get("globals")||{},t.globals.currentUser&&(o.defaults.headers.common.Authorization="Basic "+t.globals.currentUser.authdata),t.$on("$stateChangeStart",function(a,n,o,r,c){"login"===n.name||"about"===n.name||t.globals.currentUser||(a.preventDefault(),e.go("login"))}),t.$state=e,t.$stateParams=a}]),angular.module("starterapp").controller("AboutController",["$scope",function(t){t.companyName="gladdress GmbH"}]),angular.module("starterapp").factory("ContactsService",["$http","rfc4122","Base64",function(t,e,a){var n={},o=t.get("https://gladdress.azurewebsites.net/contacts/").then(function(t){return t.data});return n.getAll=function(e){return e?t.get("https://gladdress.azurewebsites.net/contacts/").then(function(t){return t.data}):o},n.getById=function(t){return o.then(function(e){return _.find(e,{GladId:t})})},n["delete"]=function(e){return t["delete"]("https://gladdress.azurewebsites.net/contacts/"+e.GladId)},n.create=function(e){return t.post("https://gladdress.azurewebsites.net/contacts",{GladId:e})},n}]),angular.module("starterapp").controller("ContactsListController",["$scope","ContactsService","$state",function(t,e,a){t.contacts=[],t.dataLoading=!0,e.getAll().then(function(e){t.contacts=e,t.dataLoading=!1}),t.loadContacts=function(n){t.contacts=[],t.dataLoading=!0,e.getAll(!0).then(function(e){t.contacts=e,t.dataLoading=!1,n&&a.go("contacts.detail",{id:n})})},t.addContact=function(){a.go("contacts.new")},t.loadContacts(),t.$on("refreshContacts",function(e,a){t.loadContacts(a)})}]),angular.module("starterapp").controller("ContactsDetailsController",["$scope","ContactsService","contact","$state","$rootScope",function(t,e,a,n,o){t.contact=a,t["delete"]=function(){confirm("Are you sure?")&&(t.dataLoading=!0,e["delete"](a).success(function(t){o.$broadcast("refreshContacts"),n.go("contacts")}).error(function(e,a){t.dataLoading=!1;var n=e.Message;t.error=n}))}}]),angular.module("starterapp").filter("gMapsFilter",function(){return function(t){return t.replace(/\n|-| /g,"+")}}),angular.module("starterapp").filter("urlFilter",function(){return function(t,e){return"<a"+(e?' target="blank"':"")+' href="'+t+'">'+t+"</a>"}}),angular.module("starterapp").controller("ContactsNewController",["$scope","ContactsService","$state","$rootScope",function(t,e,a,n){t.contact={},t.cancel=function(){a.go("contacts")},t.create=function(){t.dataLoading=!0;var a=t.contact.GladId;0===a.indexOf("http")&&(a=a.match("http[s]?://(www.)?gladdress.com/(.*).html")[2]),e.create(a).success(function(){n.$broadcast("refreshContacts",a)}).error(function(e,a){t.dataLoading=!1;var n=e.Message;switch(a){case 404:n="glad-card not found"}t.error=n})}}]),angular.module("starterapp").factory("AuthenticationService",["Base64","$http","$rootScope","$cookieStore",function(t,e,a,n){var o={};return o.Login=function(a,n,o){var r=t.encode(a+":"+n);e.defaults.headers.common.Authorization="Basic "+r,e.get("https://gladdress.azurewebsites.net/profiles",{username:a,password:n}).success(function(t){o(!0)}).error(function(t){o(t)})},o.SetCredentials=function(o,r){var c=t.encode(o+":"+r);a.globals={currentUser:{username:o,authdata:c}},e.defaults.headers.common.Authorization="Basic "+c,n.put("globals",a.globals)},o.ClearCredentials=function(){a.globals={},n.remove("globals"),e.defaults.headers.common.Authorization="Basic "},o}]),angular.module("starterapp").factory("Base64",function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(e){var a,n,o,r,c,s="",l="",i="",u=0;do a=e.charCodeAt(u++),n=e.charCodeAt(u++),l=e.charCodeAt(u++),o=a>>2,r=(3&a)<<4|n>>4,c=(15&n)<<2|l>>6,i=63&l,isNaN(n)?c=i=64:isNaN(l)&&(i=64),s=s+t.charAt(o)+t.charAt(r)+t.charAt(c)+t.charAt(i),a=n=l="",o=r=c=i="";while(u<e.length);return s},decode:function(e){var a,n,o,r,c,s="",l="",i="",u=0,d=/[^A-Za-z0-9\+\/\=]/g;d.exec(e)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do o=t.indexOf(e.charAt(u++)),r=t.indexOf(e.charAt(u++)),c=t.indexOf(e.charAt(u++)),i=t.indexOf(e.charAt(u++)),a=o<<2|r>>4,n=(15&r)<<4|c>>2,l=(3&c)<<6|i,s+=String.fromCharCode(a),64!=c&&(s+=String.fromCharCode(n)),64!=i&&(s+=String.fromCharCode(l)),a=n=l="",o=r=c=i="";while(u<e.length);return s}}}),angular.module("starterapp").controller("LoginController",["$scope","$rootScope","$state","AuthenticationService",function(t,e,a,n){n.ClearCredentials(),t.login=function(){t.dataLoading=!0,n.Login(t.username,t.password,function(e){e===!0?(n.SetCredentials(t.username,t.password),a.go("contacts")):(t.error=e.Message,t.dataLoading=!1)})}}]);
